<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School ERP - Interactive Demo with Tours</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        border: "hsl(214.3 31.8% 91.4%)",
                        input: "hsl(214.3 31.8% 91.4%)",
                        ring: "hsl(262.1 83.3% 57.8%)",
                        background: "hsl(0 0% 100%)",
                        foreground: "hsl(222.2 84% 4.9%)",
                        primary: {
                            DEFAULT: "hsl(262.1 83.3% 57.8%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                        secondary: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        destructive: {
                            DEFAULT: "hsl(0 84.2% 60.2%)",
                            foreground: "hsl(210 40% 98%)",
                        },
                        muted: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(215.4 16.3% 46.9%)",
                        },
                        accent: {
                            DEFAULT: "hsl(210 40% 96%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        popover: {
                            DEFAULT: "hsl(0 0% 100%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                        card: {
                            DEFAULT: "hsl(0 0% 100%)",
                            foreground: "hsl(222.2 84% 4.9%)",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                    keyframes: {
                        slideInDown: {
                            from: { opacity: 0, transform: 'translateY(-10px)' },
                            to: { opacity: 1, transform: 'translateY(0)' }
                        },
                        pulse: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.5 }
                        },
                        ping: {
                            '75%, 100%': { transform: 'scale(2)', opacity: 0 }
                        },
                        bounce: {
                            '0%, 100%': { transform: 'translateY(-25%)', animationTimingFunction: 'cubic-bezier(0.8, 0, 1, 1)' },
                            '50%': { transform: 'translateY(0)', animationTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)' }
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' }
                        },
                        fadeIn: {
                            from: { opacity: 0 },
                            to: { opacity: 1 }
                        },
                        scaleIn: {
                            from: { transform: 'scale(0.9)', opacity: 0 },
                            to: { transform: 'scale(1)', opacity: 1 }
                        }
                    },
                    animation: {
                        slideInDown: "slideInDown 0.3s ease-out",
                        pulse: "pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite",
                        ping: "ping 1s cubic-bezier(0, 0, 0.2, 1) infinite",
                        bounce: "bounce 1s infinite",
                        wiggle: "wiggle 1s ease-in-out infinite",
                        fadeIn: "fadeIn 0.5s ease-out",
                        scaleIn: "scaleIn 0.3s ease-out"
                    },
                },
            },
        }
    </script>
    <style>
        :root {
            --radius: 0.5rem;
        }
        
        .mini-schedule-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2px;
        }
        
        .mini-cell {
            width: 20px;
            height: 16px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .schedule-grid {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            gap: 1px;
            background: hsl(214.3 31.8% 91.4%);
        }
        
        .teacher-schedule-grid {
            display: grid;
            grid-template-columns: 150px repeat(5, 1fr) 80px;
            gap: 1px;
            background: hsl(214.3 31.8% 91.4%);
        }
        
        @media (max-width: 768px) {
            .schedule-grid {
                grid-template-columns: 80px repeat(5, 1fr);
                font-size: 12px;
            }
            
            .teacher-schedule-grid {
                grid-template-columns: 120px repeat(3, 1fr) 60px;
                font-size: 12px;
            }
        }

        .tour-highlight {
            position: relative;
            z-index: 1001;
            box-shadow: 0 0 20px 5px rgba(139, 92, 246, 0.6) !important;
            border-radius: 8px;
        }

        .view-tour-highlight {
            position: relative;
            z-index: 1001;
            box-shadow: 0 0 20px 5px rgba(59, 130, 246, 0.6) !important;
            border-radius: 8px;
        }

        .demo-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 9999;
            transition: all 0.3s ease;
        }

        .interaction-ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(139, 92, 246, 0.3);
            transform: scale(0);
            animation: ripple 0.6s linear;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // shadcn/ui inspired components
        const Button = ({ children, variant = "default", size = "default", className = "", onClick, disabled, ...props }) => {
            const baseClasses = "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50";
            
            const variants = {
                default: "bg-primary text-primary-foreground hover:bg-primary/90",
                destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
                outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
                secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
                ghost: "hover:bg-accent hover:text-accent-foreground",
                link: "text-primary underline-offset-4 hover:underline",
            };
            
            const sizes = {
                default: "h-10 px-4 py-2",
                sm: "h-9 rounded-md px-3",
                lg: "h-11 rounded-md px-8",
                icon: "h-10 w-10",
            };
            
            const handleClick = useCallback((e) => {
                e.preventDefault();
                e.stopPropagation();
                if (onClick && !disabled) {
                    onClick(e);
                }
            }, [onClick, disabled]);
            
            return (
                <button
                    className={`${baseClasses} ${variants[variant]} ${sizes[size]} ${className}`}
                    onClick={handleClick}
                    disabled={disabled}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        const Card = ({ children, className = "" }) => (
            <div className={`rounded-lg border bg-card text-card-foreground shadow-sm ${className}`}>
                {children}
            </div>
        );

        const CardHeader = ({ children, className = "" }) => (
            <div className={`flex flex-col space-y-1.5 p-6 ${className}`}>
                {children}
            </div>
        );

        const CardTitle = ({ children, className = "" }) => (
            <h3 className={`text-2xl font-semibold leading-none tracking-tight ${className}`}>
                {children}
            </h3>
        );

        const CardContent = ({ children, className = "" }) => (
            <div className={`p-6 pt-0 ${className}`}>
                {children}
            </div>
        );

        const Badge = ({ children, variant = "default", className = "" }) => {
            const variants = {
                default: "bg-primary text-primary-foreground hover:bg-primary/80",
                secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
                destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/80",
                outline: "text-foreground border border-input",
                success: "bg-green-500 text-white hover:bg-green-600",
                warning: "bg-yellow-500 text-white hover:bg-yellow-600",
            };
            
            return (
                <div className={`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 ${variants[variant]} ${className}`}>
                    {children}
                </div>
            );
        };

        const Dialog = ({ open, onOpenChange, children }) => {
            if (!open) return null;
            
            const handleOverlayClick = useCallback((e) => {
                if (e.target === e.currentTarget) {
                    onOpenChange(false);
                }
            }, [onOpenChange]);
            
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center">
                    <div 
                        className="fixed inset-0 bg-black/50" 
                        onClick={handleOverlayClick}
                    />
                    <div className="relative bg-background rounded-lg shadow-lg max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto animate-scaleIn">
                        {children}
                    </div>
            );
        };

        const DialogHeader = ({ children, className = "" }) => (
            <div className={`flex flex-col space-y-1.5 text-center sm:text-left p-6 pb-2 ${className}`}>
                {children}
            </div>
        );

        const DialogTitle = ({ children, className = "" }) => (
            <h2 className={`text-lg font-semibold leading-none tracking-tight ${className}`}>
                {children}
            </h2>
        );

        const DialogContent = ({ children, className = "" }) => (
            <div className={`px-6 pb-6 ${className}`}>
                {children}
            </div>
        );

        // Sample data
        const initialData = {
            classes: [
                { id: '10a', name: 'Class 10A', students: 30, subjects: ['Mathematics', 'Physics', 'English'] },
                { id: '10b', name: 'Class 10B', students: 28, subjects: ['Mathematics', 'Chemistry', 'English'] },
                { id: '9a', name: 'Class 9A', students: 32, subjects: ['Mathematics', 'Physics'] }
            ],
            subjects: [
                { id: 'math', name: 'Mathematics', classes: ['10a', '10b', '9a'], teacher: 'Dr. Smith', status: 'optimal' },
                { id: 'physics', name: 'Physics', classes: ['10a', '9a'], teacher: 'Ms. Johnson', status: 'warning' },
                { id: 'english', name: 'English', classes: ['10a', '10b'], teacher: 'Mr. Brown', status: 'warning' },
                { id: 'chemistry', name: 'Chemistry', classes: ['10b'], teacher: 'Dr. Wilson', status: 'critical' }
            ],
            teachers: [
                { id: 'smith', name: 'Dr. Smith', subject: 'Mathematics', classes: 3, hours: 15, status: 'optimal' },
                { id: 'johnson', name: 'Ms. Johnson', subject: 'Physics', classes: 2, hours: 10, status: 'underloaded' },
                { id: 'brown', name: 'Mr. Brown', subject: 'English', classes: 2, hours: 10, status: 'underloaded' },
                { id: 'wilson', name: 'Dr. Wilson', subject: 'Chemistry', classes: 5, hours: 25, status: 'overloaded' }
            ],
            assistants: [
                { id: 'davis', name: 'Ms. Davis', subject: 'Mathematics', classes: 2, hours: 8, status: 'active' },
                { id: 'taylor', name: 'Mr. Taylor', subject: 'Science', classes: 1, hours: 4, status: 'underloaded' },
                { id: 'lee', name: 'Ms. Lee', subject: 'Language', classes: 0, hours: 0, status: 'unassigned' }
            ]
        };

        // Interactive Demo Cursor Component
        const DemoCursor = ({ isActive, position }) => {
            if (!isActive) return null;

            return (
                <div 
                    className="demo-cursor"
                    style={{ left: position.x, top: position.y }}
                >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path 
                            d="M3 3L10.5 10.5M10.5 10.5L21 21M10.5 10.5L8 21L10.5 10.5Z" 
                            stroke="#8b5cf6" 
                            strokeWidth="2" 
                            fill="#8b5cf6"
                            className="animate-pulse"
                        />
                    </svg>
                </div>
            );
        };

        // Interactive Demo Component
        const InteractiveDemo = ({ isActive, onComplete }) => {
            const [currentStep, setCurrentStep] = useState(0);
            const [cursorPosition, setCursorPosition] = useState({ x: 0, y: 0 });
            const [showRipple, setShowRipple] = useState(false);
            const [ripplePosition, setRipplePosition] = useState({ x: 0, y: 0 });

            const demoSteps = [
                {
                    target: '[data-demo="class-tab"]',
                    action: 'click',
                    description: 'User clicks on Class View tab',
                    duration: 2000
                },
                {
                    target: '[data-demo="network-option"]',
                    action: 'click',
                    description: 'User selects Network View option',
                    duration: 2000
                },
                {
                    target: '[data-demo="class-node"]',
                    action: 'click',
                    description: 'User clicks on a class node to select it',
                    duration: 2000
                },
                {
                    target: '[data-demo="schedule-toggle"]',
                    action: 'click',
                    description: 'User toggles the schedule grid view',
                    duration: 2000
                },
                {
                    target: '[data-demo="teacher-tab"]',
                    action: 'click',
                    description: 'User switches to Teacher View',
                    duration: 2000
                },
                {
                    target: '[data-demo="schedule-option"]',
                    action: 'click',
                    description: 'User selects Schedule View option',
                    duration: 2000
                }
            ];

            const createRipple = (x, y) => {
                setRipplePosition({ x, y });
                setShowRipple(true);
                setTimeout(() => setShowRipple(false), 600);
            };

            useEffect(() => {
                if (!isActive) return;

                const runDemo = async (stepIndex) => {
                    if (stepIndex >= demoSteps.length) {
                        onComplete();
                        return;
                    }

                    const step = demoSteps[stepIndex];
                    const element = document.querySelector(step.target);
                    
                    if (element) {
                        const rect = element.getBoundingClientRect();
                        const targetX = rect.left + rect.width / 2;
                        const targetY = rect.top + rect.height / 2;

                        // Animate cursor to target
                        setCursorPosition({ x: targetX, y: targetY });

                        setTimeout(() => {
                            // Create click ripple effect
                            createRipple(targetX - 10, targetY - 10);
                            
                            // Simulate click
                            if (step.action === 'click') {
                                element.click();
                            }

                            setTimeout(() => {
                                setCurrentStep(stepIndex + 1);
                                runDemo(stepIndex + 1);
                            }, 1000);
                        }, 1000);
                    } else {
                        setTimeout(() => {
                            setCurrentStep(stepIndex + 1);
                            runDemo(stepIndex + 1);
                        }, 500);
                    }
                };

                runDemo(0);
            }, [isActive, onComplete]);

            if (!isActive) return null;

            return (
                <>
                    <DemoCursor isActive={isActive} position={cursorPosition} />
                    {showRipple && (
                        <div 
                            className="interaction-ripple"
                            style={{
                                left: ripplePosition.x,
                                top: ripplePosition.y,
                                width: '20px',
                                height: '20px'
                            }}
                        />
                    )}
                    <div className="fixed top-4 right-4 z-50 bg-white rounded-lg shadow-lg p-4 max-w-sm animate-slideInDown">
                        <div className="flex items-center gap-2 mb-2">
                            <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span className="font-semibold text-sm">Interactive Demo</span>
                        </div>
                        <div className="text-xs text-muted-foreground">
                            {demoSteps[currentStep]?.description || 'Demo completed!'}
                        </div>
                        <div className="mt-2 bg-muted rounded-full h-2">
                            <div 
                                className="bg-primary h-2 rounded-full transition-all duration-500"
                                style={{ width: `${((currentStep + 1) / demoSteps.length) * 100}%` }}
                            />
                        </div>
                    </div>
                </>
            );
        };

        // Animated Walkthrough Component (Main Tour)
        const AnimatedWalkthrough = ({ isActive, onComplete }) => {
            const [currentStep, setCurrentStep] = useState(0);
            const [showTooltip, setShowTooltip] = useState(false);
            const [tooltipPosition, setTooltipPosition] = useState({ x: 0, y: 0 });
            const [currentStepData, setCurrentStepData] = useState(null);

            const steps = [
                {
                    target: '[data-tour="header"]',
                    title: 'Welcome to Simflo ERP',
                    description: 'Your comprehensive school management system with multiple views and powerful analytics.',
                    duration: 3000
                },
                {
                    target: '[data-tour="view-tabs"]',
                    title: 'View Selection',
                    description: 'Switch between Class, Teacher, and Subject management views to access different functionalities.',
                    duration: 3000
                },
                {
                    target: '[data-tour="option-tabs"]',
                    title: 'View Options',
                    description: 'Each main view has multiple display options - Network, Cards, Schedule, and Analytics.',
                    duration: 3000
                },
                {
                    target: '[data-tour="schedule-toggle"]',
                    title: 'Schedule Grid Toggle',
                    description: 'Enable or disable the schedule grid view to see time-based assignments.',
                    duration: 3000
                },
                {
                    target: '[data-tour="network-nodes"]',
                    title: 'Interactive Network',
                    description: 'Click on any node to select it and see detailed information. Color coding shows status.',
                    duration: 3000
                },
                {
                    target: '[data-tour="walkthrough-btn"]',
                    title: 'Interactive Tour',
                    description: 'Click this button anytime to restart the guided tour and explore all features.',
                    duration: 3000
                }
            ];

            useEffect(() => {
                if (!isActive) return;

                const runStep = async (stepIndex) => {
                    if (stepIndex >= steps.length) {
                        setShowTooltip(false);
                        onComplete();
                        return;
                    }

                    const step = steps[stepIndex];
                    const element = document.querySelector(step.target);
                    
                    if (element) {
                        const rect = element.getBoundingClientRect();
                        setTooltipPosition({
                            x: rect.left + rect.width / 2,
                            y: rect.top - 10
                        });
                        setCurrentStepData(step);
                        setShowTooltip(true);

                        // Add highlight effect
                        element.classList.add('tour-highlight');
                    }

                    setTimeout(() => {
                        if (element) {
                            element.classList.remove('tour-highlight');
                        }
                        setShowTooltip(false);
                        setCurrentStep(stepIndex + 1);
                        setTimeout(() => runStep(stepIndex + 1), 500);
                    }, step.duration);
                };

                runStep(0);
            }, [isActive, onComplete]);

            if (!isActive || !showTooltip || !currentStepData) return null;

            return (
                <>
                    {/* Overlay */}
                    <div className="fixed inset-0 bg-black/50 z-40" />
                    
                    {/* Animated SVG Pointer */}
                    <svg 
                        className="fixed pointer-events-none z-50"
                        style={{ 
                            left: tooltipPosition.x - 20, 
                            top: tooltipPosition.y - 40,
                            width: '40px',
                            height: '40px'
                        }}
                    >
                        <circle 
                            cx="20" 
                            cy="20" 
                            r="15" 
                            fill="none" 
                            stroke="#8b5cf6" 
                            strokeWidth="3"
                            className="animate-ping"
                        />
                        <circle 
                            cx="20" 
                            cy="20" 
                            r="8" 
                            fill="#8b5cf6"
                            className="animate-pulse"
                        />
                        <path
                            d="M20 25 L15 30 L20 35 L25 30 Z"
                            fill="#8b5cf6"
                            className="animate-bounce"
                        />
                    </svg>

                    {/* Tooltip */}
                    <div 
                        className="fixed z-50 bg-white rounded-lg shadow-xl p-4 max-w-sm border-2 border-primary animate-slideInDown"
                        style={{
                            left: Math.max(10, Math.min(tooltipPosition.x - 150, window.innerWidth - 320)),
                            top: tooltipPosition.y - 140
                        }}
                    >
                        <div className="font-semibold text-primary mb-2">{currentStepData.title}</div>
                        <div className="text-sm text-foreground mb-3">
                            {currentStepData.description}
                        </div>
                        <div className="flex justify-between items-center">
                            <div className="text-xs text-muted-foreground">
                                Step {currentStep + 1} of {steps.length}
                            </div>
                            <div className="flex gap-1">
                                {steps.map((_, index) => (
                                    <div 
                                        key={index}
                                        className={`w-2 h-2 rounded-full ${
                                            index === currentStep ? 'bg-primary' : 'bg-muted'
                                        }`}
                                    />
                                ))}
                            </div>
                        </div>
                        <div className="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
                            <div className="w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-primary"></div>
                        </div>
                    </div>
                </>
            );
        };

        // View-Specific Tour Component
        const ViewSpecificTour = ({ isActive, currentView, currentOption, onComplete }) => {
            const [currentStep, setCurrentStep] = useState(0);
            const [showTooltip, setShowTooltip] = useState(false);
            const [tooltipPosition, setTooltipPosition] = useState({ x: 0, y: 0 });
            const [currentStepData, setCurrentStepData] = useState(null);

            const getViewSteps = () => {
                const tourKey = `${currentView}-${currentOption}`;
                
                const tours = {
                    'class-network': [
                        {
                            target: '[data-view-tour="network-explanation"]',
                            title: 'Network View Explanation',
                            description: 'This panel explains how the network view works and what each column represents.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="classes-column"]',
                            title: 'Classes Column',
                            description: 'Each row shows one class with student count and subject assignments. Click to select.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="subjects-column"]',
                            title: 'Subjects Column',
                            description: 'Each row displays one subject with class coverage and status indicators.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="teachers-column"]',
                            title: 'Teachers Column',
                            description: 'Each row represents one teacher with workload and assignment details.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="assistants-column"]',
                            title: 'Assistants Column',
                            description: 'Each row shows one assistant teacher with availability status.',
                            duration: 3000
                        },
                        {
                            target: '[data-tour="schedule-toggle"]',
                            title: 'Schedule Toggle',
                            description: 'Toggle this to show/hide the schedule grid column with mini time slots.',
                            duration: 3000
                        }
                    ],
                    'class-cards': [
                        {
                            target: '[data-view-tour="cards-explanation"]',
                            title: 'Card View Explanation',
                            description: 'This panel explains the card layout and what each element represents.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="card-structure"]',
                            title: 'Card Structure',
                            description: 'Each card represents one class with header showing name and student count.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="subject-rows"]',
                            title: 'Subject Rows',
                            description: 'Each row within a card shows one assigned subject with teacher and schedule.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="add-subject"]',
                            title: 'Add Subject Row',
                            description: 'Dashed border indicates available slots for assigning new subjects.',
                            duration: 3000
                        }
                    ],
                    'class-schedule': [
                        {
                            target: '[data-view-tour="schedule-explanation"]',
                            title: 'Schedule View Explanation',
                            description: 'This panel explains the schedule grid structure and time slot system.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="grid-structure"]',
                            title: 'Grid Structure',
                            description: 'Each grid shows one class with time rows and day columns for scheduling.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="occupied-slots"]',
                            title: 'Occupied Time Slots',
                            description: 'Blue cells show assigned periods with subject name and teacher.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="available-slots"]',
                            title: 'Available Slots',
                            description: 'Dashed border cells are available for new assignments.',
                            duration: 3000
                        }
                    ],
                    'teacher-cards': [
                        {
                            target: '[data-view-tour="teacher-cards"]',
                            title: 'Teacher Card Layout',
                            description: 'Each card shows one teacher with their subject specialization and workload.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="assignment-rows"]',
                            title: 'Assignment Rows',
                            description: 'Each row shows a class assignment with subject and time slot.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="overload-indicator"]',
                            title: 'Overload Indicators',
                            description: 'Red highlighting and badges show teachers with excessive workload.',
                            duration: 3000
                        }
                    ],
                    'teacher-schedule': [
                        {
                            target: '[data-view-tour="teacher-schedule-grid"]',
                            title: 'Teacher Schedule Grid',
                            description: 'Master grid showing all teachers and their weekly schedules.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="assigned-slots"]',
                            title: 'Assigned Time Slots',
                            description: 'Blue cells show "Hour - Class Subject" format for each assignment.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="overload-periods"]',
                            title: 'Overload Periods',
                            description: 'Red highlighting indicates periods where teachers are overloaded.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="load-status"]',
                            title: 'Load Status Column',
                            description: 'Shows total weekly hours and status: Optimal (12-18h), Under (<12h), Over (>18h).',
                            duration: 3000
                        }
                    ],
                    'teacher-workload': [
                        {
                            target: '[data-view-tour="summary-cards"]',
                            title: 'Workload Summary Cards',
                            description: 'Overview cards showing optimal, underloaded, and overloaded teacher counts.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="distribution-chart"]',
                            title: 'Hours Distribution Chart',
                            description: 'Visual chart showing each teacher\'s weekly hours with color-coded status.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="efficiency-metrics"]',
                            title: 'Efficiency Metrics',
                            description: 'Key performance indicators including variance, efficiency, and optimization potential.',
                            duration: 3000
                        }
                    ],
                    'subject-overview': [
                        {
                            target: '[data-view-tour="subject-cards"]',
                            title: 'Subject Overview Cards',
                            description: 'Each card shows one subject with coverage statistics and teacher assignments.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="subject-metrics"]',
                            title: 'Subject Metrics',
                            description: 'Key numbers showing classes covered, total students, and weekly hours.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="teacher-assignments"]',
                            title: 'Teacher Assignments',
                            description: 'Shows primary teacher (PT) and assistant teacher (AT) assignments.',
                            duration: 3000
                        }
                    ],
                    'subject-coverage': [
                        {
                            target: '[data-view-tour="coverage-matrix"]',
                            title: 'Coverage Matrix Table',
                            description: 'Grid showing which subjects are assigned to which classes.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="status-cells"]',
                            title: 'Assignment Status Cells',
                            description: 'Green checkmarks show assigned subjects, gray warnings show unassigned.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="coverage-percentage"]',
                            title: 'Coverage Percentage',
                            description: 'Shows what percentage of classes have this subject assigned.',
                            duration: 3000
                        }
                    ],
                    'subject-analytics': [
                        {
                            target: '[data-view-tour="analytics-summary"]',
                            title: 'Analytics Summary Cards',
                            description: 'Key metrics showing overall coverage, average classes per subject, and critical issues.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="performance-bars"]',
                            title: 'Subject Performance Bars',
                            description: 'Visual progress bars showing coverage percentage for each subject.',
                            duration: 3000
                        },
                        {
                            target: '[data-view-tour="progress-indicators"]',
                            title: 'Progress Indicators',
                            description: 'Color-coded bars: green (100%), yellow (67%), red (33%) coverage.',
                            duration: 3000
                        }
                    ]
                };

                return tours[tourKey] || [];
            };

            useEffect(() => {
                if (!isActive) return;

                const steps = getViewSteps();
                if (steps.length === 0) {
                    onComplete();
                    return;
                }

                const runStep = async (stepIndex) => {
                    if (stepIndex >= steps.length) {
                        setShowTooltip(false);
                        onComplete();
                        return;
                    }

                    const step = steps[stepIndex];
                    const element = document.querySelector(step.target);
                    
                    if (element) {
                        const rect = element.getBoundingClientRect();
                        setTooltipPosition({
                            x: rect.left + rect.width / 2,
                            y: rect.top - 10
                        });
                        setCurrentStepData(step);
                        setShowTooltip(true);

                        element.classList.add('view-tour-highlight');
                    }

                    setTimeout(() => {
                        if (element) {
                            element.classList.remove('view-tour-highlight');
                        }
                        setShowTooltip(false);
                        setCurrentStep(stepIndex + 1);
                        setTimeout(() => runStep(stepIndex + 1), 500);
                    }, step.duration);
                };

                setCurrentStep(0);
                runStep(0);
            }, [isActive, currentView, currentOption, onComplete]);

            if (!isActive || !showTooltip || !currentStepData) return null;

            const steps = getViewSteps();

            return (
                <>
                    <div className="fixed inset-0 bg-black/50 z-40" />
                    
                    <svg 
                        className="fixed pointer-events-none z-50"
                        style={{ 
                            left: tooltipPosition.x - 20, 
                            top: tooltipPosition.y - 40,
                            width: '40px',
                            height: '40px'
                        }}
                    >
                        <circle 
                            cx="20" 
                            cy="20" 
                            r="15" 
                            fill="none" 
                            stroke="#3b82f6" 
                            strokeWidth="3"
                            className="animate-ping"
                        />
                        <circle 
                            cx="20" 
                            cy="20" 
                            r="8" 
                            fill="#3b82f6"
                            className="animate-pulse"
                        />
                        <path
                            d="M20 25 L15 30 L20 35 L25 30 Z"
                            fill="#3b82f6"
                            className="animate-bounce"
                        />
                    </svg>

                    <div 
                        className="fixed z-50 bg-white rounded-lg shadow-xl p-4 max-w-sm border-2 border-blue-500 animate-slideInDown"
                        style={{
                            left: Math.max(10, Math.min(tooltipPosition.x - 150, window.innerWidth - 320)),
                            top: tooltipPosition.y - 140
                        }}
                    >
                        <div className="font-semibold text-blue-600 mb-2">{currentStepData.title}</div>
                        <div className="text-sm text-foreground mb-3">
                            {currentStepData.description}
                        </div>
                        <div className="flex justify-between items-center">
                            <div className="text-xs text-muted-foreground">
                                Step {currentStep + 1} of {steps.length}
                            </div>
                            <div className="flex gap-1">
                                {steps.map((_, index) => (
                                    <div 
                                        key={index}
                                        className={`w-2 h-2 rounded-full ${
                                            index === currentStep ? 'bg-blue-500' : 'bg-muted'
                                        }`}
                                    />
                                ))}
                            </div>
                        </div>
                        <div className="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
                            <div className="w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-blue-500"></div>
                        </div>
                    </div>
                </>
            );
        };

        // Network Node Component
        const NetworkNode = ({ title, subtitle, info, status, indicator, onClick, selected, className = "" }) => {
            const statusClasses = {
                optimal: "border-green-500 bg-green-50",
                warning: "border-yellow-500 bg-yellow-50",
                critical: "border-red-500 bg-red-50",
                underloaded: "border-yellow-500 bg-yellow-50",
                overloaded: "border-red-500 bg-red-50",
                unassigned: "border-yellow-500 bg-yellow-50"
            };

            const indicatorClasses = {
                warning: "bg-yellow-500",
                error: "bg-red-500",
                success: "bg-green-500"
            };

            const handleClick = useCallback((e) => {
                e.preventDefault();
                e.stopPropagation();
                if (onClick) {
                    onClick();
                }
            }, [onClick]);

            return (
                <div 
                    className={`
                        relative bg-white border-2 rounded-xl p-4 m-2 cursor-pointer transition-all duration-300 
                        hover:border-primary hover:-translate-y-1 hover:shadow-lg min-w-[140px] text-center
                        ${selected ? 'border-primary bg-primary text-primary-foreground' : 'border-border'}
                        ${status ? statusClasses[status] : ''}
                        ${className}
                    `}
                    onClick={handleClick}
                >
                    {indicator && (
                        <div className={`absolute -top-2 -right-2 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold text-white ${indicatorClasses[indicator.type]}`}>
                            {indicator.text}
                        </div>
                    )}
                    <div className={`font-semibold text-sm mb-1 ${selected ? 'text-primary-foreground' : 'text-foreground'}`}>
                        {title}
                    </div>
                    <div className={`text-xs mb-1 ${selected ? 'text-primary-foreground/80' : 'text-muted-foreground'}`}>
                        {subtitle}
                    </div>
                    <div className={`text-xs font-medium ${selected ? 'text-primary-foreground/90' : 'text-primary'}`}>
                        {info}
                    </div>
            );
        };

        // Mini Schedule Grid Component
        const MiniScheduleGrid = ({ subject, onClick }) => {
            const scheduleData = {
                'Mathematics': [
                    ['M', 'T', 'W', 'T', 'F'],
                    ['assigned', 'assigned', 'assigned', 'available', 'available'],
                    ['assigned', 'available', 'available', 'available', 'available']
                ],
                'Physics': [
                    ['M', 'T', 'W', 'T', 'F'],
                    ['available', 'assigned', 'assigned', 'available', 'assigned'],
                    ['available', 'available', 'available', 'available', 'available']
                ],
                'English': [
                    ['M', 'T', 'W', 'T', 'F'],
                    ['assigned', 'available', 'assigned', 'available', 'assigned'],
                    ['available', 'available', 'available', 'available', 'available']
                ],
                'Chemistry': [
                    ['M', 'T', 'W', 'T', 'F'],
                    ['available', 'available', 'available', 'conflict', 'available'],
                    ['available', 'available', 'available', 'available', 'available']
                ]
            };

            const data = scheduleData[subject] || scheduleData['Mathematics'];
            const cellClasses = {
                assigned: 'bg-primary text-primary-foreground',
                available: 'bg-muted text-muted-foreground',
                conflict: 'bg-destructive text-destructive-foreground'
            };

            const handleClick = useCallback((e) => {
                e.preventDefault();
                e.stopPropagation();
                if (onClick) {
                    onClick();
                }
            }, [onClick]);

            return (
                <div className="mini-schedule-grid my-2" onClick={handleClick}>
                    {data.slice(1).map((row, rowIndex) => 
                        row.map((cell, cellIndex) => (
                            <div 
                                key={`${rowIndex}-${cellIndex}`}
                                className={`mini-cell ${cellClasses[cell] || cellClasses.available}`}
                                title={`${data[0][cellIndex]} - ${cell}`}
                            >
                                {cell === 'assigned' ? data[0][cellIndex] : ''}
                            </div>
                        ))
                    )}
                </div>
            );
        };

        // Network View Component
        const NetworkView = ({ data, selectedNode, onNodeSelect, showScheduleGrid, isAnyTourActive }) => {
            return (
                <div className="space-y-6">
                    {/* Network View Explanation */}
                    {!isAnyTourActive && (
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4" data-view-tour="network-explanation">
                            <h4 className="font-semibold text-blue-800 mb-2">🔗 Network View - Interactive Entity Relationships</h4>
                            <p className="text-sm text-blue-700 mb-3">
                                This view shows all system entities and their relationships. Each column represents a different entity type, 
                                and each row within a column shows individual records with their current status and key metrics.
                            </p>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3 text-xs">
                                <div><strong>Classes Column:</strong> Student groups with subject assignments</div>
                                <div><strong>Subjects Column:</strong> Core subjects with class coverage</div>
                                <div><strong>Teachers Column:</strong> Primary teachers with workload status</div>
                                <div><strong>Assistants Column:</strong> Assistant teachers with availability</div>
                                <div><strong>Schedule Grid:</strong> Time-based assignment visualization</div>
                            </div>
                        </div>
                    )}

                    <div className="bg-muted/30 rounded-xl p-8 mb-8" data-tour="network-nodes">
                        <div className="flex justify-between items-start min-h-[400px]">
                            {/* Classes Column */}
                            <div className="flex flex-col items-center flex-1" data-view-tour="classes-column">
                                <h3 className="text-xl font-semibold mb-4 text-primary">Classes</h3>
                                {!isAnyTourActive && (
                                    <div className="text-xs text-center text-muted-foreground mb-4 px-2">
                                        Each row = One class group showing student count and assigned subjects
                                    </div>
                                )}
                                {data.classes.map((cls, index) => (
                                    <div key={cls.id} className="w-full mb-2">
                                        {!isAnyTourActive && (
                                            <div className="text-xs text-muted-foreground mb-1 text-center">
                                                Row {index + 1}: {cls.name} ({cls.students} students, {cls.subjects.length} subjects)
                                            </div>
                                        )}
                                        <NetworkNode
                                            title={cls.name}
                                            subtitle={`${cls.students} Students`}
                                            info={`${cls.subjects.length} subjects assigned`}
                                            status={cls.subjects.length < 3 ? 'warning' : 'optimal'}
                                            indicator={cls.subjects.length < 3 ? { type: 'warning', text: '!' } : null}
                                            selected={selectedNode?.type === 'class' && selectedNode?.id === cls.id}
                                            onClick={() => onNodeSelect('class', cls)}
                                            data-demo="class-node"
                                        />
                                    </div>
                                ))}
                            </div>

                            {/* Subjects Column */}
                            <div className="flex flex-col items-center flex-1" data-view-tour="subjects-column">
                                <h3 className="text-xl font-semibold mb-4 text-primary">Subjects</h3>
                                {!isAnyTourActive && (
                                    <div className="text-xs text-center text-muted-foreground mb-4 px-2">
                                        Each row = One subject showing class coverage and teacher assignment
                                    </div>
                                )}
                                {data.subjects.map((subject, index) => (
                                    <div key={subject.id} className="w-full mb-2">
                                        {!isAnyTourActive && (
                                            <div className="text-xs text-muted-foreground mb-1 text-center">
                                                Row {index + 1}: {subject.name} (covers {subject.classes.length} classes, status: {subject.status})
                                            </div>
                                        )}
                                        <NetworkNode
                                            title={subject.name}
                                            subtitle="Core Subject"
                                            info={`${subject.classes.length} classes assigned`}
                                            status={subject.status}
                                            indicator={subject.status !== 'optimal' ? { 
                                                type: subject.status === 'critical' ? 'error' : 'warning', 
                                                text: subject.status === 'critical' ? '⚠' : '!' 
                                            } : null}
                                            selected={selectedNode?.type === 'subject' && selectedNode?.id === subject.id}
                                            onClick={() => onNodeSelect('subject', subject)}
                                        />
                                    </div>
                                ))}
                            </div>

                            {/* Teachers Column */}
                            <div className="flex flex-col items-center flex-1" data-view-tour="teachers-column">
                                <h3 className="text-xl font-semibold mb-4 text-primary">Teachers</h3>
                                {!isAnyTourActive && (
                                    <div className="text-xs text-center text-muted-foreground mb-4 px-2">
                                        Each row = One teacher showing workload and class assignments
                                    </div>
                                )}
                                {data.teachers.map((teacher, index) => (
                                    <div key={teacher.id} className="w-full mb-2">
                                        {!isAnyTourActive && (
                                            <div className="text-xs text-muted-foreground mb-1 text-center">
                                                Row {index + 1}: {teacher.name} ({teacher.hours}h/week, {teacher.classes} classes, {teacher.status})
                                            </div>
                                        )}
                                        <NetworkNode
                                            title={teacher.name}
                                            subtitle={teacher.subject}
                                            info={`${teacher.classes} classes, ${teacher.hours} hrs/week`}
                                            status={teacher.status}
                                            indicator={teacher.status !== 'optimal' ? { 
                                                type: teacher.status === 'overloaded' ? 'error' : 'warning', 
                                                text: teacher.status === 'overloaded' ? '⚠' : '!' 
                                            } : null}
                                            selected={selectedNode?.type === 'teacher' && selectedNode?.id === teacher.id}
                                            onClick={() => onNodeSelect('teacher', teacher)}
                                        />
                                    </div>
                                ))}
                            </div>

                            {/* Assistant Teachers Column */}
                            <div className="flex flex-col items-center flex-1" data-view-tour="assistants-column">
                                <h3 className="text-xl font-semibold mb-4 text-primary">Assistant Teachers</h3>
                                {!isAnyTourActive && (
                                    <div className="text-xs text-center text-muted-foreground mb-4 px-2">
                                        Each row = One assistant showing availability and assignments
                                    </div>
                                )}
                                {data.assistants.map((assistant, index) => (
                                    <div key={assistant.id} className="w-full mb-2">
                                        {!isAnyTourActive && (
                                            <div className="text-xs text-muted-foreground mb-1 text-center">
                                                Row {index + 1}: {assistant.name} ({assistant.hours}h/week, {assistant.classes} classes, {assistant.status})
                                            </div>
                                        )}
                                        <NetworkNode
                                            title={assistant.name}
                                            subtitle={`${assistant.subject} Assistant`}
                                            info={`${assistant.classes} classes, ${assistant.hours} hrs/week`}
                                            status={assistant.status}
                                            indicator={assistant.status === 'unassigned' ? { type: 'error', text: '⚠' } : 
                                                      assistant.status === 'underloaded' ? { type: 'warning', text: '!' } : null}
                                            selected={selectedNode?.type === 'assistant' && selectedNode?.id === assistant.id}
                                            onClick={() => onNodeSelect('assistant', assistant)}
                                        />
                                    </div>
                                ))}
                            </div>

                            {/* Schedule Grid Column */}
                            {showScheduleGrid && (
                                <div className={`flex flex-col items-center flex-1 transition-all duration-300 ${showScheduleGrid ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-5'}`}>
                                    <h3 className="text-xl font-semibold mb-4 text-primary">Schedule Grid</h3>
                                    {!isAnyTourActive && (
                                        <div className="text-xs text-center text-muted-foreground mb-4 px-2">
                                            Each row = One subject's weekly schedule with time slots
                                        </div>
                                    )}
                                    {data.subjects.map((subject, index) => (
                                        <div key={`schedule-${subject.id}`} className="w-full mb-2">
                                            {!isAnyTourActive && (
                                                <div className="text-xs text-muted-foreground mb-1 text-center">
                                                    Row {index + 1}: {subject.name} schedule (mini grid shows M-F time slots)
                                                </div>
                                            )}
                                            <NetworkNode
                                                title={subject.name}
                                                subtitle={<MiniScheduleGrid subject={subject.name} />}
                                                info={`${subject.classes.length} classes assigned`}
                                                status={subject.status}
                                                indicator={subject.status !== 'optimal' ? { 
                                                    type: subject.status === 'critical' ? 'error' : 'warning', 
                                                    text: subject.status === 'critical' ? '⚠' : '!' 
                                                } : null}
                                                className="min-w-[180px]"
                                                onClick={() => onNodeSelect('schedule', subject)}
                                            />
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
            );
        };

        // Class Card Component
        const ClassCard = ({ classData, subjects, teachers, isAnyTourActive }) => {
            const getSubjectDetails = (subjectName) => {
                const subject = subjects.find(s => s.name === subjectName);
                const teacher = teachers.find(t => t.name === subject?.teacher);
                return { subject, teacher };
            };

            return (
                <Card className="hover:border-primary transition-colors" data-view-tour="card-structure">
                    <CardHeader className="flex flex-row items-center justify-between">
                        <CardTitle className="text-xl">{classData.name}</CardTitle>
                        <Button variant="ghost" size="icon">
                            ✏️
                        </Button>
                    </CardHeader>
                    <CardContent>
                        <div className="space-y-3">
                            {classData.subjects.map((subjectName, index) => {
                                const { subject, teacher } = getSubjectDetails(subjectName);
                                return (
                                    <div key={subjectName} className="space-y-1" data-view-tour="subject-rows">
                                        {!isAnyTourActive && (
                                            <div className="text-xs text-muted-foreground px-2">
                                                Subject Row {index + 1}: {subjectName} - Shows teacher assignment, schedule time, and assistant
                                            </div>
                                        )}
                                        <div className={`p-4 rounded-lg border transition-colors hover:bg-muted/50 ${teacher?.status === 'overloaded' ? 'border-destructive bg-destructive/5' : 'border-border bg-muted/20'}`}>
                                            <div className="flex justify-between items-start">
                                                <div className="flex-1">
                                                    <div className="font-semibold flex items-center gap-2">
                                                        {subjectName}
                                                        {teacher?.status === 'overloaded' && (
                                                            <Badge variant="destructive" className="text-xs">+2</Badge>
                                                        )}
                                                    </div>
                                                    <div className="text-sm text-primary font-medium mt-1">
                                                        Mon 9:00-10:00
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <Badge variant={teacher?.status === 'overloaded' ? 'destructive' : 'secondary'} className="mb-1">
                                                        {teacher?.name || 'No Teacher'}
                                                    </Badge>
                                                    <div>
                                                        <Badge variant="outline" className="text-xs">
                                                            Ms. Davis
                                                        </Badge>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                            {classData.subjects.length < 3 && (
                                <div className="space-y-1" data-view-tour="add-subject">
                                    <div className="p-4 rounded-lg border-2 border-dashed border-yellow-500 bg-yellow-50 cursor-pointer hover:bg-yellow-100 transition-colors">
                                        <div className="text-center">
                                            <div className="font-semibold text-yellow-700 mb-2">+ Add Subject</div>
                                            <div className="text-sm text-yellow-600">Click to assign new subject</div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </CardContent>
                </Card>
                </div>
            );
        };

        // Schedule Grid Component
        const ScheduleGrid = ({ classData, isAnyTourActive }) => {
            const timeSlots = ['9:00', '10:00', '11:00'];
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            const scheduleData = {
                'Class 10A': {
                    'Mon-9:00': { subject: 'Math', teacher: 'Dr. Smith', status: 'occupied' },
                    'Wed-9:00': { subject: 'English', teacher: 'Mr. Brown', status: 'occupied' },
                    'Fri-9:00': { subject: 'Physics', teacher: 'Ms. Johnson', status: 'occupied' },
                    'Tue-10:00': { subject: 'Physics', teacher: 'Ms. Johnson', status: 'occupied' },
                    'Thu-10:00': { subject: 'Chemistry', teacher: 'Dr. Wilson', status: 'error' },
                    'Mon-11:00': { subject: 'English', teacher: 'Mr. Brown', status: 'occupied' },
                    'Wed-11:00': { subject: 'Math', teacher: 'Dr. Smith', status: 'occupied' }
                }
            };

            const getScheduleCell = (day, time) => {
                const key = `${day}-${time}`;
                return scheduleData[classData.name]?.[key] || { status: 'available' };
            };

            const cellClasses = {
                occupied: 'bg-primary text-primary-foreground',
                available: 'bg-background border-2 border-dashed border-muted-foreground/30 hover:border-primary',
                error: 'bg-destructive text-destructive-foreground border-2 border-destructive'
            };

            return (
                <Card data-view-tour="grid-structure">
                    <CardHeader className="flex flex-row items-center justify-between">
                        <CardTitle>{classData.name} - Weekly Schedule</CardTitle>
                        <Button>Add Period</Button>
                    </CardHeader>
                    <CardContent>
                        <div className="schedule-grid rounded-lg overflow-hidden">
                            <div className="bg-muted p-3 font-semibold text-center text-muted-foreground">Time</div>
                            {days.map(day => (
                                <div key={day} className="bg-muted p-3 font-semibold text-center text-muted-foreground">
                                    {day}
                                </div>
                            ))}
                            
                            {timeSlots.map(time => (
                                <React.Fragment key={time}>
                                    <div className="bg-muted p-3 font-semibold text-center text-muted-foreground">
                                        {time}
                                    </div>
                                    {days.map(day => {
                                        const cell = getScheduleCell(day, time);
                                        const isOccupied = cell.status === 'occupied';
                                        const isAvailable = cell.status === 'available';
                                        return (
                                            <div 
                                                key={`${day}-${time}`}
                                                className={`p-2 min-h-[60px] flex flex-col justify-center items-center cursor-pointer transition-colors ${cellClasses[cell.status]}`}
                                                title={cell.subject ? `${cell.subject} - ${cell.teacher}` : 'Click to assign'}
                                                data-view-tour={isOccupied ? "occupied-slots" : isAvailable ? "available-slots" : ""}
                                            >
                                                {cell.subject && (
                                                    <>
                                                        <div className="text-xs font-semibold">{cell.subject}</div>
                                                        <div className="text-xs opacity-80">{cell.teacher?.split(' ')[1]}</div>
                                                    </>
                                                )}
                                            </div>
                                        );
                                    })}
                                </React.Fragment>
                            ))}
                        </div>
                    </CardContent>
                </Card>
                </div>
            );
        };

        // Teacher Cards Component
        const TeacherCards = ({ teachers, isAnyTourActive }) => {
            return (
                <div className="space-y-6">
                    {/* Teacher Cards Explanation */}
                    {!isAnyTourActive && (
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 className="font-semibold text-blue-800 mb-2">👨‍🏫 Teacher Cards - Individual Teacher Management</h4>
                            <p className="text-sm text-blue-700 mb-3">
                                Each card represents one teacher with their subject specialization, current assignments, and workload status. 
                                Cards are color-coded based on workload: green (optimal), yellow (underloaded), red (overloaded).
                            </p>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                <div><strong>Card Header:</strong> Teacher name with overload badge if applicable</div>
                                <div><strong>Assignment Rows:</strong> Each row shows one class assignment with subject and time</div>
                                <div><strong>Status Indicators:</strong> Color coding and badges show workload status</div>
                            </div>
                        </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" data-view-tour="teacher-cards">
                    {teachers.map((teacher, index) => (
                        <div key={teacher.id} className="space-y-2">
                            {!isAnyTourActive && (
                                <div className="text-sm text-muted-foreground bg-muted/30 rounded px-3 py-1">
                                    <strong>Teacher Card {index + 1}:</strong> {teacher.name} - {teacher.subject} specialist, 
                                    {teacher.classes} classes, {teacher.hours}h/week ({teacher.status})
                                </div>
                            )}
                            <Card className={`hover:border-primary transition-colors ${teacher.status === 'overloaded' ? 'border-destructive' : ''}`}>
                                <CardHeader className="flex flex-row items-center justify-between">
                                    <CardTitle className="flex items-center gap-2">
                                        {teacher.name}
                                        {teacher.status === 'overloaded' && (
                                            <Badge variant="destructive" data-view-tour="overload-indicator">+2</Badge>
                                        )}
                                    </CardTitle>
                                    <Button variant="ghost" size="icon">
                                        ✏️
                                    </Button>
                                </CardHeader>
                                <CardContent>
                                    <div className="space-y-3">
                                        <div className="space-y-1">
                                            {!isAnyTourActive && (
                                                <div className="text-xs text-muted-foreground px-2">
                                                    Assignment Row 1: {teacher.subject} class with time slot and status
                                                </div>
                                            )}
                                            <div className="p-3 rounded-lg bg-muted/50" data-view-tour="assignment-rows">
                                                <div className="font-medium">{teacher.subject} - Class 10A</div>
                                                <div className="text-sm text-primary">Mon 9:00-10:00</div>
                                            </div>
                                        </div>
                                        <div className="space-y-1">
                                            {!isAnyTourActive && (
                                                <div className="text-xs text-muted-foreground px-2">
                                                    Assignment Row 2: Second class assignment with schedule details
                                                </div>
                                            )}
                                            <div className="p-3 rounded-lg bg-muted/50">
                                                <div className="font-medium">{teacher.subject} - Class 10B</div>
                                                <div className="text-sm text-primary">Mon 10:00-11:00</div>
                                            </div>
                                        </div>
                                        {teacher.status === 'overloaded' && (
                                            <div className="space-y-1">
                                                {!isAnyTourActive && (
                                                    <div className="text-xs text-muted-foreground px-2">
                                                        Overload Row: Extra assignment causing workload issue (red highlighting)
                                                    </div>
                                                )}
                                                <div className="p-3 rounded-lg bg-destructive/10 border border-destructive">
                                                    <div className="font-medium text-destructive">{teacher.subject} - Class 9A</div>
                                                    <div className="text-sm text-destructive">Tue 9:00-10:00</div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </CardContent>
                            </Card>
                        </div>
                    ))}
                </div>
            );
        };

        // Teacher Schedule Grid Component
        const TeacherScheduleGrid = ({ teachers, isAnyTourActive }) => {
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            
            return (
                <div className="space-y-6">
                    {/* Teacher Schedule Grid Explanation */}
                    {!isAnyTourActive && (
                        <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 className="font-semibold text-purple-800 mb-2">🗓️ Teacher Schedule Grid - Master Weekly Overview</h4>
                            <p className="text-sm text-purple-700 mb-3">
                                Master grid showing all teachers and their weekly schedules. Each row represents one teacher, 
                                columns show daily time slots. Color coding indicates workload status and scheduling conflicts.
                            </p>
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-3 text-xs">
                                <div><strong>Teacher Column:</strong> Teacher name and subject specialization</div>
                                <div><strong>Day Columns:</strong> Mon-Fri showing assigned time slots</div>
                                <div><strong>Time Slots:</strong> Format "Hour - Class Subject" for each assignment</div>
                                <div><strong>Load Column:</strong> Total weekly hours and status (Optimal/Under/Over)</div>
                            </div>
                        </div>
                    )}

                    <Card data-view-tour="teacher-schedule-grid">
                        <CardHeader className="flex flex-row items-center justify-between">
                            <CardTitle>All Teachers - Weekly Schedule Overview</CardTitle>
                            <div className="flex gap-2">
                                <Button variant="outline">Export</Button>
                                <Button>Optimize All</Button>
                            </div>
                        </CardHeader>
                        <CardContent>
                        <div className="teacher-schedule-grid rounded-lg overflow-hidden">
                            <div className="bg-muted p-3 font-semibold text-muted-foreground">Teacher</div>
                            {days.map(day => (
                                <div key={day} className="bg-muted p-3 font-semibold text-center text-muted-foreground">
                                    {day}
                                </div>
                            ))}
                            <div className="bg-muted p-3 font-semibold text-center text-muted-foreground">Load</div>
                            
                            {teachers.map(teacher => (
                                <React.Fragment key={teacher.id}>
                                    <div className={`p-3 flex flex-col justify-center ${teacher.status === 'overloaded' ? 'bg-destructive/10 border-l-4 border-destructive' : 'bg-background'}`}>
                                        <div className="font-semibold text-sm">{teacher.name}</div>
                                        <div className="text-xs text-muted-foreground">{teacher.subject}</div>
                                    </div>
                                    {days.map(day => (
                                        <div key={`${teacher.id}-${day}`} className={`p-2 min-h-[80px] flex flex-col gap-1 ${teacher.status === 'overloaded' && day === 'Mon' ? 'bg-destructive/10 border-l-4 border-destructive' : 'bg-background'}`} data-view-tour={teacher.status === 'overloaded' && day === 'Thu' ? "overload-periods" : "assigned-slots"}>
                                            {teacher.id === 'smith' && day === 'Mon' && (
                                                <>
                                                    <div className="text-xs bg-primary text-primary-foreground px-2 py-1 rounded text-center">9:00 - 10A Math</div>
                                                    <div className="text-xs bg-primary text-primary-foreground px-2 py-1 rounded text-center">10:00 - 10B Math</div>
                                                </>
                                            )}
                                            {teacher.id === 'smith' && day === 'Tue' && (
                                                <div className="text-xs bg-primary text-primary-foreground px-2 py-1 rounded text-center">9:00 - 9A Math</div>
                                            )}
                                            {teacher.id === 'wilson' && day === 'Thu' && (
                                                <>
                                                    <div className="text-xs bg-destructive text-destructive-foreground px-2 py-1 rounded text-center">9:00 - 10B Chem</div>
                                                    <div className="text-xs bg-destructive text-destructive-foreground px-2 py-1 rounded text-center">10:00 - 11E Bio</div>
                                                </>
                                            )}
                                        </div>
                                    ))}
                                    <div className={`p-3 flex flex-col items-center justify-center ${
                                        teacher.status === 'optimal' ? 'bg-green-50 text-green-700' :
                                        teacher.status === 'underloaded' ? 'bg-yellow-50 text-yellow-700' :
                                        teacher.status === 'overloaded' ? 'bg-red-50 text-red-700' : 'bg-background'
                                    }`} data-view-tour="load-status">
                                        <div className="font-semibold">{teacher.hours}h</div>
                                        <div className="text-xs uppercase">
                                            {teacher.status === 'optimal' ? 'Optimal' :
                                             teacher.status === 'underloaded' ? 'Under' :
                                             teacher.status === 'overloaded' ? 'Over +2' : 'Normal'}
                                        </div>
                                    </div>
                                </React.Fragment>
                            ))}
                        </div>
                    </CardContent>
                </Card>
                </div>
            );
        };

        // Workload Analysis Component
        const WorkloadAnalysis = ({ teachers, isAnyTourActive }) => {
            const optimalTeachers = teachers.filter(t => t.status === 'optimal');
            const underloadedTeachers = teachers.filter(t => t.status === 'underloaded');
            const overloadedTeachers = teachers.filter(t => t.status === 'overloaded');

            return (
                <div className="space-y-8">
                    {/* Workload Analysis Explanation */}
                    {!isAnyTourActive && (
                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 className="font-semibold text-green-800 mb-2">⚖️ Workload Analysis - Teacher Load Distribution</h4>
                            <p className="text-sm text-green-700 mb-3">
                                Comprehensive analysis of teacher workloads with distribution charts, efficiency metrics, and optimization recommendations. 
                                Helps identify imbalances and opportunities for better resource allocation.
                            </p>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                <div><strong>Summary Cards:</strong> Count of optimal, underloaded, and overloaded teachers</div>
                                <div><strong>Distribution Chart:</strong> Visual bars showing each teacher's weekly hours</div>
                                <div><strong>Efficiency Metrics:</strong> KPIs including variance, efficiency, and optimization potential</div>
                            </div>
                        </div>
                    )}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6" data-view-tour="summary-cards">
                        <Card className="border-green-200 bg-green-50">
                            <CardContent className="p-6 text-center">
                                <div className="text-4xl font-bold text-green-600 mb-2">{optimalTeachers.length}</div>
                                <div className="font-semibold mb-2">Optimal Load</div>
                                <div className="text-sm text-muted-foreground">
                                    {optimalTeachers.map(t => t.name).join(', ')}
                                </div>
                            </CardContent>
                        </Card>
                        
                        <Card className="border-yellow-200 bg-yellow-50">
                            <CardContent className="p-6 text-center">
                                <div className="text-4xl font-bold text-yellow-600 mb-2">{underloadedTeachers.length}</div>
                                <div className="font-semibold mb-2">Underloaded</div>
                                <div className="text-sm text-muted-foreground">
                                    {underloadedTeachers.map(t => t.name).join(', ')}
                                </div>
                            </CardContent>
                        </Card>
                        
                        <Card className="border-red-200 bg-red-50">
                            <CardContent className="p-6 text-center">
                                <div className="text-4xl font-bold text-red-600 mb-2">{overloadedTeachers.length}</div>
                                <div className="font-semibold mb-2">Overloaded</div>
                                <div className="text-sm text-muted-foreground">
                                    {overloadedTeachers.map(t => t.name).join(', ')}
                                </div>
                            </CardContent>
                        </Card>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <Card data-view-tour="distribution-chart">
                            <CardHeader>
                                <CardTitle>Weekly Hours Distribution</CardTitle>
                            </CardHeader>
                            <CardContent>
                                <div className="flex justify-around items-end h-48">
                                    {teachers.map(teacher => (
                                        <div key={teacher.id} className="flex flex-col items-center w-16">
                                            <div 
                                                className={`w-full rounded-t mb-2 ${
                                                    teacher.status === 'optimal' ? 'bg-green-500' :
                                                    teacher.status === 'underloaded' ? 'bg-yellow-500' :
                                                    'bg-red-500'
                                                }`}
                                                style={{ height: `${(teacher.hours / 25) * 100}%` }}
                                            />
                                            <div className="text-xs text-center">
                                                <div className="font-medium">{teacher.name.split(' ')[1]}</div>
                                                <div>{teacher.hours}h</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </CardContent>
                        </Card>

                        <Card data-view-tour="efficiency-metrics">
                            <CardHeader>
                                <CardTitle>Efficiency Metrics</CardTitle>
                            </CardHeader>
                            <CardContent className="space-y-4">
                                <div className="flex justify-between items-center py-3 border-b">
                                    <span className="text-muted-foreground">Average Workload:</span>
                                    <span className="font-semibold">15 hours/week</span>
                                </div>
                                <div className="flex justify-between items-center py-3 border-b">
                                    <span className="text-muted-foreground">Workload Variance:</span>
                                    <Badge variant="warning">High (±7.5h)</Badge>
                                </div>
                                <div className="flex justify-between items-center py-3 border-b">
                                    <span className="text-muted-foreground">Schedule Efficiency:</span>
                                    <span className="font-semibold">72%</span>
                                </div>
                                <div className="flex justify-between items-center py-3">
                                    <span className="text-muted-foreground">Optimization Potential:</span>
                                    <Badge variant="success">+28%</Badge>
                                </div>
                            </CardContent>
                        </Card>
                    </div>
            );
        };

        // Subject Overview Component
        const SubjectOverview = ({ subjects, teachers, isAnyTourActive }) => {
            const getTeacherForSubject = (subjectName) => {
                return teachers.find(t => t.subject === subjectName);
            };

            return (
                <div className="space-y-6">
                    {/* Subject Overview Explanation */}
                    {!isAnyTourActive && (
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 className="font-semibold text-blue-800 mb-2">📚 Subject Overview - Subject-Centric Management</h4>
                            <p className="text-sm text-blue-700 mb-3">
                                Each card represents one subject with coverage statistics, teacher assignments, and status indicators. 
                                Shows how subjects are distributed across classes and which teachers are assigned.
                            </p>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                <div><strong>Subject Cards:</strong> Individual cards for each subject with status color coding</div>
                                <div><strong>Coverage Metrics:</strong> Classes covered, total students, and weekly hours</div>
                                <div><strong>Teacher Assignments:</strong> Primary Teacher (PT) and Assistant Teacher (AT) badges</div>
                            </div>
                        </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" data-view-tour="subject-cards">
                    {subjects.map((subject, index) => {
                        const teacher = getTeacherForSubject(subject.name);
                        return (
                            <div key={subject.id} className="space-y-2">
                                {!isAnyTourActive && (
                                    <div className="text-sm text-muted-foreground bg-muted/30 rounded px-3 py-1">
                                        <strong>Subject Card {index + 1}:</strong> {subject.name} - covers {subject.classes.length} classes, 
                                        taught by {subject.teacher}, status: {subject.status}
                                    </div>
                                )}
                                <Card className={`
                                    ${subject.status === 'optimal' ? 'border-green-200 bg-gradient-to-br from-green-50 to-white' :
                                      subject.status === 'warning' ? 'border-yellow-200 bg-gradient-to-br from-yellow-50 to-white' :
                                      'border-red-200 bg-gradient-to-br from-red-50 to-white'}
                                `}>
                                <CardHeader className="flex flex-row items-center justify-between">
                                    <CardTitle>{subject.name}</CardTitle>
                                    <Badge variant={
                                        subject.status === 'optimal' ? 'success' :
                                        subject.status === 'warning' ? 'warning' :
                                        'destructive'
                                    }>
                                        {subject.status === 'optimal' ? 'Fully Assigned' :
                                         subject.status === 'warning' ? 'Needs 1 Class' :
                                         'Critical Issue'}
                                    </Badge>
                                </CardHeader>
                                <CardContent>
                                    <div className="flex justify-around mb-6" data-view-tour="subject-metrics">
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-primary">{subject.classes.length}</div>
                                            <div className="text-xs uppercase text-muted-foreground">Classes</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-primary">
                                                {subject.classes.length * 30}
                                            </div>
                                            <div className="text-xs uppercase text-muted-foreground">Students</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-primary">
                                                {subject.classes.length * 5}
                                            </div>
                                            <div className="text-xs uppercase text-muted-foreground">Hours/Week</div>
                                        </div>
                                    </div>
                                    
                                    <div className="flex justify-between items-center pt-4 border-t" data-view-tour="teacher-assignments">
                                        <div className="flex items-center gap-2">
                                            <Badge className="bg-primary text-primary-foreground">PT</Badge>
                                            <span className={teacher?.status === 'overloaded' ? 'text-destructive' : ''}>
                                                {subject.teacher}
                                            </span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <Badge variant="outline" className="bg-green-500 text-white">AT</Badge>
                                            <span className="text-sm">Ms. Davis</span>
                                        </div>
                                    </div>
                                </CardContent>
                            </Card>
                            </div>
                        );
                    })}
                </div>
            );
        };

        // Main App Component
        const SchoolERP = () => {
            const [currentView, setCurrentView] = useState('class');
            const [currentOption, setCurrentOption] = useState('network');
            const [selectedNode, setSelectedNode] = useState(null);
            const [showScheduleGrid, setShowScheduleGrid] = useState(true);
            const [data, setData] = useState(initialData);
            const [modalOpen, setModalOpen] = useState(false);
            const [modalContent, setModalContent] = useState(null);
            const [showWalkthrough, setShowWalkthrough] = useState(false);
            const [showViewTour, setShowViewTour] = useState(false);
            const [showDemo, setShowDemo] = useState(false);

            // Check if any tour is currently active
            const isAnyTourActive = showWalkthrough || showViewTour || showDemo;

            const handleNodeSelect = useCallback((type, nodeData) => {
                setSelectedNode({ type, id: nodeData.id, data: nodeData });
            }, []);

            const openScheduleModal = useCallback((subject) => {
                setModalContent({
                    type: 'schedule',
                    title: `${subject} - Schedule Grid`,
                    subject
                });
                setModalOpen(true);
            }, []);

            const startWalkthrough = useCallback(() => {
                setShowWalkthrough(true);
            }, []);

            const completeWalkthrough = useCallback(() => {
                setShowWalkthrough(false);
            }, []);

            const startViewTour = useCallback(() => {
                setShowViewTour(true);
            }, []);

            const completeViewTour = useCallback(() => {
                setShowViewTour(false);
            }, []);

            const startDemo = useCallback(() => {
                setShowDemo(true);
            }, []);

            const completeDemo = useCallback(() => {
                setShowDemo(false);
            }, []);

            const handleViewChange = useCallback((viewId) => {
                setCurrentView(viewId);
                const options = getViewOptions(viewId);
                setCurrentOption(options[0]?.id || 'network');
            }, []);

            const handleOptionChange = useCallback((optionId) => {
                setCurrentOption(optionId);
            }, []);

            const handleScheduleToggle = useCallback((e) => {
                setShowScheduleGrid(e.target.checked);
            }, []);

            const renderCurrentView = () => {
                switch (currentView) {
                    case 'class':
                        return renderClassView();
                    case 'teacher':
                        return renderTeacherView();
                    case 'subject':
                        return renderSubjectView();
                    default:
                        return renderClassView();
                }
            };

            const renderClassView = () => {
                switch (currentOption) {
                    case 'network':
                        return (
                            <NetworkView 
                                data={data}
                                selectedNode={selectedNode}
                                onNodeSelect={handleNodeSelect}
                                showScheduleGrid={showScheduleGrid}
                                isAnyTourActive={isAnyTourActive}
                            />
                        );
                    case 'cards':
                        return (
                            <div className="space-y-6">
                                {/* Card View Explanation */}
                                {!isAnyTourActive && (
                                    <div className="bg-green-50 border border-green-200 rounded-lg p-4" data-view-tour="cards-explanation">
                                        <h4 className="font-semibold text-green-800 mb-2">📋 Card Grid View - Individual Class Management</h4>
                                        <p className="text-sm text-green-700 mb-3">
                                            Each card represents one class with all its assigned subjects, teachers, and schedules. 
                                            Cards are arranged in a responsive grid for easy scanning and management.
                                        </p>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                            <div><strong>Card Header:</strong> Class name, student count, and edit button</div>
                                            <div><strong>Subject Rows:</strong> Each row shows one assigned subject with teacher and schedule</div>
                                            <div><strong>Add Subject Row:</strong> Dashed border indicates available slot for new subject</div>
                                        </div>
                                    </div>
                                )}

                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {data.classes.map((cls, index) => (
                                        <div key={cls.id} className="space-y-2">
                                            {!isAnyTourActive && (
                                                <div className="text-sm text-muted-foreground bg-muted/30 rounded px-3 py-1">
                                                    <strong>Card {index + 1}:</strong> {cls.name} - Contains {cls.subjects.length} subject rows + 
                                                    {cls.subjects.length < 3 ? ' 1 add-subject row' : ' no available slots'}
                                                </div>
                                            )}
                                            <ClassCard 
                                                classData={cls}
                                                subjects={data.subjects}
                                                teachers={data.teachers}
                                                isAnyTourActive={isAnyTourActive}
                                            />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    case 'schedule':
                        return (
                            <div className="space-y-6">
                                {/* Schedule View Explanation */}
                                {!isAnyTourActive && (
                                    <div className="bg-purple-50 border border-purple-200 rounded-lg p-4" data-view-tour="schedule-explanation">
                                        <h4 className="font-semibold text-purple-800 mb-2">📅 Schedule View - Time-Based Class Management</h4>
                                        <p className="text-sm text-purple-700 mb-3">
                                            Each schedule grid shows one class's weekly timetable. Time slots are arranged in rows (hours) and columns (days). 
                                            Each cell represents a specific time period that can be assigned to subjects and teachers.
                                        </p>
                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-3 text-xs">
                                            <div><strong>Grid Header:</strong> Class name and "Add Period" button</div>
                                            <div><strong>Time Rows:</strong> Each row represents one hour slot (9:00, 10:00, 11:00)</div>
                                            <div><strong>Day Columns:</strong> Mon-Sun columns for weekly scheduling</div>
                                            <div><strong>Cell Content:</strong> Subject name and teacher, or empty for available slots</div>
                                        </div>
                                    </div>
                                )}

                                {data.classes.map((cls, index) => (
                                    <div key={cls.id} className="space-y-3">
                                        {!isAnyTourActive && (
                                            <div className="text-sm text-muted-foreground bg-muted/30 rounded px-3 py-2">
                                                <strong>Schedule Grid {index + 1}:</strong> {cls.name} - Shows 3 time rows × 7 day columns = 21 total time slots. 
                                                Blue cells = occupied periods, dashed = available, red = conflicts.
                                            </div>
                                        )}
                                        <ScheduleGrid classData={cls} isAnyTourActive={isAnyTourActive} />
                                    </div>
                                ))}
                            </div>
                        );
                    case 'graph':
                        return (
                            <Card>
                                <CardHeader>
                                    <CardTitle>Class Management - Graph Analytics</CardTitle>
                                </CardHeader>
                                <CardContent>
                                    <div className="h-96 flex items-center justify-center bg-muted/30 rounded-lg">
                                        <div className="text-center">
                                            <div className="text-6xl mb-4">📊</div>
                                            <div className="text-xl font-semibold mb-2">Analytics Dashboard</div>
                                            <div className="text-muted-foreground">Interactive charts and insights would be displayed here</div>
                                        </div>
                                    </div>
                                </CardContent>
                            </Card>
                            </div>
                        );
                    default:
                        return null;
                }
            };

            const renderTeacherView = () => {
                switch (currentOption) {
                    case 'cards':
                        return <TeacherCards teachers={data.teachers} isAnyTourActive={isAnyTourActive} />;
                    case 'schedule':
                        return <TeacherScheduleGrid teachers={data.teachers} isAnyTourActive={isAnyTourActive} />;
                    case 'workload':
                        return <WorkloadAnalysis teachers={data.teachers} isAnyTourActive={isAnyTourActive} />;
                    default:
                        return <TeacherCards teachers={data.teachers} isAnyTourActive={isAnyTourActive} />;
                }
            };

            const renderSubjectView = () => {
                switch (currentOption) {
                    case 'overview':
                        return <SubjectOverview subjects={data.subjects} teachers={data.teachers} isAnyTourActive={isAnyTourActive} />;
                    case 'coverage':
                        return (
                            <div className="space-y-6">
                                {/* Subject Coverage Explanation */}
                                {!isAnyTourActive && (
                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                        <h4 className="font-semibold text-yellow-800 mb-2">📋 Subject Coverage Matrix - Assignment Overview</h4>
                                        <p className="text-sm text-yellow-700 mb-3">
                                            Matrix table showing which subjects are assigned to which classes. Each row represents a subject, 
                                            columns represent classes. Cells show assignment status and teacher information.
                                        </p>
                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-3 text-xs">
                                            <div><strong>Matrix Structure:</strong> Subjects in rows, classes in columns</div>
                                            <div><strong>Assignment Cells:</strong> Green checkmarks for assigned, gray warnings for unassigned</div>
                                            <div><strong>Teacher Names:</strong> Shows which teacher is assigned to each subject-class pair</div>
                                            <div><strong>Coverage %:</strong> Percentage of classes that have this subject assigned</div>
                                        </div>
                                    </div>
                                )}

                                <Card data-view-tour="coverage-matrix">
                                    <CardHeader>
                                        <CardTitle>Subject-Class Coverage Matrix</CardTitle>
                                    </CardHeader>
                                    <CardContent>
                                    <div className="overflow-x-auto">
                                        <table className="w-full border-collapse">
                                            <thead>
                                                <tr>
                                                    <th className="border p-3 bg-muted text-left">Subject</th>
                                                    <th className="border p-3 bg-muted text-center">Class 10A</th>
                                                    <th className="border p-3 bg-muted text-center">Class 10B</th>
                                                    <th className="border p-3 bg-muted text-center">Class 9A</th>
                                                    <th className="border p-3 bg-muted text-center">Coverage %</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.subjects.map(subject => (
                                                    <tr key={subject.id}>
                                                        <td className="border p-3 font-medium">{subject.name}</td>
                                                        <td className="border p-3 text-center" data-view-tour="status-cells">
                                                            {subject.classes.includes('10a') ? (
                                                                <Badge variant="success">✓ {subject.teacher}</Badge>
                                                            ) : (
                                                                <Badge variant="outline">⚠ Unassigned</Badge>
                                                            )}
                                                        </td>
                                                        <td className="border p-3 text-center">
                                                            {subject.classes.includes('10b') ? (
                                                                <Badge variant="success">✓ {subject.teacher}</Badge>
                                                            ) : (
                                                                <Badge variant="outline">⚠ Unassigned</Badge>
                                                            )}
                                                        </td>
                                                        <td className="border p-3 text-center">
                                                            {subject.classes.includes('9a') ? (
                                                                <Badge variant="success">✓ {subject.teacher}</Badge>
                                                            ) : (
                                                                <Badge variant="outline">⚠ Unassigned</Badge>
                                                            )}
                                                        </td>
                                                        <td className="border p-3 text-center" data-view-tour="coverage-percentage">
                                                            <Badge variant={
                                                                subject.status === 'optimal' ? 'success' :
                                                                subject.status === 'warning' ? 'warning' :
                                                                'destructive'
                                                            }>
                                                                {subject.status === 'optimal' ? '100%' :
                                                                 subject.status === 'warning' ? '67%' : '33%'}
                                                            </Badge>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </CardContent>
                            </Card>
                            </div>
                        );
                    case 'analytics':
                        return (
                            <div className="space-y-8">
                                {/* Subject Analytics Explanation */}
                                {!isAnyTourActive && (
                                    <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                        <h4 className="font-semibold text-green-800 mb-2">📈 Subject Analytics - Performance Metrics</h4>
                                        <p className="text-sm text-green-700 mb-3">
                                            Comprehensive analytics showing subject performance across the school. Includes coverage statistics, 
                                            efficiency metrics, and visual progress indicators for each subject.
                                        </p>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                            <div><strong>Summary Cards:</strong> Overall coverage, average classes per subject, critical issues</div>
                                            <div><strong>Performance Bars:</strong> Visual progress bars showing coverage percentage</div>
                                            <div><strong>Color Coding:</strong> Green (100%), yellow (67%), red (33%) coverage levels</div>
                                        </div>
                                    </div>
                                )}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6" data-view-tour="analytics-summary">
                                    <Card>
                                        <CardContent className="p-6 text-center">
                                            <div className="text-4xl font-bold text-primary mb-2">67%</div>
                                            <div className="font-semibold mb-2">Overall Coverage</div>
                                            <div className="text-sm text-yellow-600">↓ 8% from target</div>
                                        </CardContent>
                                    </Card>
                                    <Card>
                                        <CardContent className="p-6 text-center">
                                            <div className="text-4xl font-bold text-primary mb-2">2.3</div>
                                            <div className="font-semibold mb-2">Avg Classes/Subject</div>
                                            <div className="text-sm text-muted-foreground">→ Stable</div>
                                        </CardContent>
                                    </Card>
                                    <Card>
                                        <CardContent className="p-6 text-center">
                                            <div className="text-4xl font-bold text-primary mb-2">1</div>
                                            <div className="font-semibold mb-2">Critical Issues</div>
                                            <div className="text-sm text-red-600">↑ Needs attention</div>
                                        </CardContent>
                                    </Card>
                                </div>
                                
                                <Card data-view-tour="performance-bars">
                                    <CardHeader>
                                        <CardTitle>Subject Performance Overview</CardTitle>
                                    </CardHeader>
                                    <CardContent>
                                        <div className="space-y-4">
                                            {data.subjects.map(subject => (
                                                <div key={subject.id} className="flex items-center gap-4">
                                                    <div className="w-24 text-sm font-medium">{subject.name}</div>
                                                    <div className="flex-1 h-2 bg-muted rounded-full overflow-hidden">
                                                        <div 
                                                            className={`h-full ${
                                                                subject.status === 'optimal' ? 'bg-green-500' :
                                                                subject.status === 'warning' ? 'bg-yellow-500' :
                                                                'bg-red-500'
                                                            }`}
                                                            style={{ 
                                                                width: subject.status === 'optimal' ? '100%' :
                                                                       subject.status === 'warning' ? '67%' : '33%'
                                                            }}
                                                            data-view-tour="progress-indicators"
                                                        />
                                                    </div>
                                                    <div className="w-12 text-sm font-semibold text-right">
                                                        {subject.status === 'optimal' ? '100%' :
                                                         subject.status === 'warning' ? '67%' : '33%'}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </CardContent>
                                </Card>
                            </div>
                        );
                    default:
                        return <SubjectOverview subjects={data.subjects} teachers={data.teachers} isAnyTourActive={isAnyTourActive} />;
                }
            };

            const getViewOptions = (viewType = currentView) => {
                switch (viewType) {
                    case 'class':
                        return [
                            { id: 'network', label: 'Network View' },
                            { id: 'cards', label: 'Card Grid' },
                            { id: 'schedule', label: 'Schedule View' },
                            { id: 'graph', label: 'Graph Analytics' }
                        ];
                    case 'teacher':
                        return [
                            { id: 'cards', label: 'Teacher Cards' },
                            { id: 'schedule', label: 'Schedule View' },
                            { id: 'workload', label: 'Workload Analysis' }
                        ];
                    case 'subject':
                        return [
                            { id: 'overview', label: 'Subject Overview' },
                            { id: 'coverage', label: 'Class Coverage' },
                            { id: 'analytics', label: 'Analytics' }
                        ];
                    default:
                        return [];
                }
            };

            const getCurrentOptionDescription = () => {
                const descriptions = {
                    // Class View Options
                    'class-network': '🔗 Interactive network showing relationships between classes, subjects, teachers, and assistants. Click nodes to select and see details.',
                    'class-cards': '📋 Card-based layout showing each class with assigned subjects, teachers, and assistant teachers. Easy to scan and manage.',
                    'class-schedule': '📅 Weekly schedule grid for each class showing time slots, subjects, and teacher assignments. Identify conflicts and gaps.',
                    'class-graph': '📊 Analytics dashboard with charts and insights about class performance, subject distribution, and optimization opportunities.',
                    
                    // Teacher View Options
                    'teacher-cards': '👨‍🏫 Individual teacher cards showing their assigned classes, subjects, and current workload status (optimal/under/overloaded).',
                    'teacher-schedule': '🗓️ Master schedule grid showing all teachers\' weekly assignments. Each row represents a teacher, columns show daily schedules.',
                    'teacher-workload': '⚖️ Workload analysis with distribution charts, efficiency metrics, and recommendations for balancing teacher assignments.',
                    
                    // Subject View Options
                    'subject-overview': '📚 Subject cards showing coverage across classes, assigned teachers (PT/AT), student count, and weekly hours.',
                    'subject-coverage': '📋 Matrix view showing which classes have each subject assigned. Identify coverage gaps and assignment conflicts.',
                    'subject-analytics': '📈 Performance metrics for subjects including coverage percentages, efficiency scores, and optimization potential.'
                };
                
                return descriptions[`${currentView}-${currentOption}`] || 'Select an option to see its description.';
            };

            const getViewTourButtonText = () => {
                switch (currentView) {
                    case 'class':
                        return 'Class Tour';
                    case 'teacher':
                        return 'Teacher Tour';
                    case 'subject':
                        return 'Subject Tour';
                    default:
                        return 'View Tour';
                }
            };

            return (
                <div className="min-h-screen bg-background font-sans">
                    <div className="max-w-7xl mx-auto p-6">
                        {/* Header */}
                        <div className="flex justify-between items-center mb-8 pb-6 border-b" data-tour="header">
                            <div className="text-2xl font-bold text-primary">Simflo ERP</div>
                            <div className="flex items-center gap-4">
                                <Button 
                                    variant="outline" 
                                    size="sm"
                                    onClick={startDemo}
                                    className="flex items-center gap-2 bg-green-50 border-green-200 text-green-700 hover:bg-green-100"
                                >
                                    🎬 Watch Demo
                                </Button>
                                <Button 
                                    variant="outline" 
                                    size="sm"
                                    onClick={startViewTour}
                                    className="flex items-center gap-2 bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100"
                                >
                                    🔍 {getViewTourButtonText()}
                                </Button>
                                <Button 
                                    variant="outline" 
                                    size="sm"
                                    onClick={startWalkthrough}
                                    data-tour="walkthrough-btn"
                                    className="flex items-center gap-2"
                                >
                                    🎯 Main Tour
                                </Button>
                                <div className="flex bg-muted rounded-lg p-1" data-tour="view-tabs">
                                    {[
                                        { id: 'class', label: 'Class View' },
                                        { id: 'teacher', label: 'Teacher View' },
                                        { id: 'subject', label: 'Subject View' }
                                    ].map(view => (
                                        <Button
                                            key={view.id}
                                            variant={currentView === view.id ? "default" : "ghost"}
                                            size="sm"
                                            onClick={() => handleViewChange(view.id)}
                                            data-demo={`${view.id}-tab`}
                                        >
                                            {view.label}
                                        </Button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Section Title with Description */}
                        <div className="mb-8">
                            <h2 className="text-2xl font-bold mb-3">
                                {currentView === 'class' && 'Class Management - Multiple UI Options'}
                                {currentView === 'teacher' && 'Teacher Management'}
                                {currentView === 'subject' && 'Subject Management'}
                            </h2>
                            <div className="text-muted-foreground text-sm bg-muted/30 rounded-lg p-4">
                                {currentView === 'class' && (
                                    <div>
                                        <strong>Class Management:</strong> Manage student groups, their assigned subjects, and schedules. 
                                        Each class shows student count, assigned subjects, teachers, and schedule conflicts.
                                    </div>
                                )}
                                {currentView === 'teacher' && (
                                    <div>
                                        <strong>Teacher Management:</strong> Monitor teacher workloads, assignments, and availability. 
                                        Track optimal (15h), underloaded (&lt;12h), and overloaded (&gt;18h) teachers across all subjects.
                                    </div>
                                )}
                                {currentView === 'subject' && (
                                    <div>
                                        <strong>Subject Management:</strong> Overview of subject coverage across classes. 
                                        Monitor which classes have assigned teachers, identify gaps, and track subject-specific metrics.
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Options Navigation */}
                        <div className="mb-8 border-b">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex gap-4" data-tour="option-tabs">
                                    {getViewOptions().map(option => (
                                        <button
                                            key={option.id}
                                            className={`pb-3 px-1 border-b-2 font-medium transition-colors ${
                                                currentOption === option.id
                                                    ? 'border-primary text-primary'
                                                    : 'border-transparent text-muted-foreground hover:text-foreground'
                                            }`}
                                            onClick={() => handleOptionChange(option.id)}
                                            data-demo={`${option.id}-option`}
                                        >
                                            {option.label}
                                        </button>
                                    ))}
                                </div>
                                
                                {currentView === 'class' && currentOption === 'network' && (
                                    <div className="flex items-center gap-2" data-tour="schedule-toggle" data-demo="schedule-toggle">
                                        <input
                                            type="checkbox"
                                            id="schedule-grid-toggle"
                                            checked={showScheduleGrid}
                                            onChange={handleScheduleToggle}
                                            className="rounded"
                                        />
                                        <label htmlFor="schedule-grid-toggle" className="text-sm text-muted-foreground">
                                            Show Schedule Grid
                                        </label>
                                    </div>
                                )}
                            </div>
                            
                            {/* Current Option Description */}
                            <div className="text-xs text-muted-foreground bg-accent/50 rounded px-3 py-2 mb-4">
                                {getCurrentOptionDescription()}
                            </div>
                        </div>

                        {/* Main Content */}
                        {renderCurrentView()}

                        {/* Modal */}
                        <Dialog open={modalOpen} onOpenChange={setModalOpen}>
                            {modalContent && (
                                <>
                                    <DialogHeader>
                                        <DialogTitle>{modalContent.title}</DialogTitle>
                                    </DialogHeader>
                                    <DialogContent>
                                        {modalContent.type === 'schedule' && (
                                            <div>
                                                <p className="mb-4 text-muted-foreground">
                                                    Click on time slots to assign periods for this subject:
                                                </p>
                                                <div className="grid grid-cols-6 gap-2 mb-4">
                                                    {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                                        <div key={day} className="text-center font-semibold text-xs p-2">
                                                            {day}
                                                        </div>
                                                    ))}
                                                    {['9:00', '10:00', '11:00'].map(time => 
                                                        ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                                            <Button
                                                                key={`${day}-${time}`}
                                                                variant={
                                                                    (day === 'Tue' && time === '9:00') || 
                                                                    (day === 'Wed' && time === '10:00') || 
                                                                    (day === 'Thu' && time === '11:00') ? 'default' :
                                                                    (day === 'Thu' && time === '9:00') ? 'destructive' : 'outline'
                                                                }
                                                                size="sm"
                                                                className="h-8 text-xs"
                                                            >
                                                                {time}
                                                            </Button>
                                                        ))
                                                    )}
                                                </div>
                                                <div className="mb-4 p-3 bg-muted rounded-lg text-sm">
                                                    <strong>Legend:</strong>
                                                    <span className="ml-2 text-primary">■ Assigned</span>
                                                    <span className="ml-2 text-green-600">■ Available</span>
                                                    <span className="ml-2 text-red-600">■ Conflict</span>
                                                </div>
                                                <div className="flex gap-2">
                                                    <Button variant="outline" onClick={() => setModalOpen(false)}>
                                                        Cancel
                                                    </Button>
                                                    <Button onClick={() => setModalOpen(false)}>
                                                        Save Schedule
                                                    </Button>
                                                </div>
                                            </div>
                                        )}
                                    </DialogContent>
                                </>
                            )}
                        </Dialog>

                        {/* Tours and Demo */}
                        <AnimatedWalkthrough 
                            isActive={showWalkthrough} 
                            onComplete={completeWalkthrough}
                        />
                        
                        <ViewSpecificTour 
                            isActive={showViewTour}
                            currentView={currentView}
                            currentOption={currentOption}
                            onComplete={completeViewTour}
                        />

                        <InteractiveDemo 
                            isActive={showDemo}
                            onComplete={completeDemo}
                        />
                    </div>
            );
        };

        // Render the app
        ReactDOM.render(<SchoolERP />, document.getElementById('root'));
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a841ea41787fd3',t:'MTc1NDQxNzQ5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
